"use strict";(self.webpackChunkpmapp=self.webpackChunkpmapp||[]).push([[19],{19:function(e,s,n){n.r(s),n.d(s,{default:function(){return N}});var t=n(791),i=n(165),r=n(861),a=n(433),c=n(413),l=n(439),o=n(164),u=n(821),d=n(976);var f=n.p+"static/media/plus.9bedc2bd675a1c320c22c273b8a0daa7.svg",p=n(184);function x(e){var s=e.onClick;return(0,p.jsx)("div",{className:"milestone-header create",onClick:s,children:(0,p.jsxs)("div",{className:"milestone-header-first",children:[(0,p.jsx)("img",{src:f,alt:"icon"}),(0,p.jsx)("span",{className:"title",children:d.eI.createMilestone})]})})}var h,v,m=n(942);function j(e){var s=e.issue,n=e.onCancel,a=e.onOk,o=(0,t.useState)(s||{}),f=(0,l.Z)(o,2),x=f[0],h=f[1],v=(0,t.useState)(!1),j=(0,l.Z)(v,2),I=j[0],g=j[1];function Z(e){var s=e.name,n=e.value;s&&h((0,c.Z)((0,c.Z)({},x),{},(0,m.Z)({},s,n)))}function b(){return(b=(0,r.Z)((0,i.Z)().mark((function e(s){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s.preventDefault(),g(!0),e.next=5,a(x);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:return e.prev=10,g(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])})))).apply(this,arguments)}return(0,p.jsxs)("form",{children:[(0,p.jsxs)(u.cw,{children:[(0,p.jsx)(u.__,{required:!0,children:d.eI.titleLable}),(0,p.jsx)(u.Kx,{required:!0,name:"title",value:null===x||void 0===x?void 0:x.title,onChange:function(e){return Z(e.target)},rows:2,autofocus:!0})]}),(0,p.jsxs)(u.cw,{children:[(0,p.jsx)(u.__,{children:d.eI.descriptionLabel}),(0,p.jsx)(u.Kx,{name:"description",value:null===x||void 0===x?void 0:x.description,onChange:function(e){return Z(e.target)},rows:5})]}),(0,p.jsx)(u.cw,{children:(0,p.jsxs)("div",{className:"actions",children:[(0,p.jsx)(u.zx,{onClick:n,children:d.eI.cancel}),(0,p.jsx)(u.zx,{type:"primary",onClick:function(e){return function(e){return b.apply(this,arguments)}(e)},loading:I,children:d.eI.save})]})})]})}!function(e){e.OPENED="opened",e.CLOSED="closed"}(h||(h={})),function(e){e.ACTIVE="active",e.CLOSED="closed"}(v||(v={}));var I=3e5;function g(e){var s=e.milestone,n=e.projectId,c=e.editHandler,f=(0,t.useState)([]),x=(0,l.Z)(f,2),v=x[0],m=x[1],g=(0,t.useState)(!0),b=(0,l.Z)(g,2),y=b[0],k=b[1],w=(0,t.useState)({isVisible:!1}),_=(0,l.Z)(w,2),N=_[0],L=_[1];(0,t.useEffect)((function(){var e=setInterval((function(){return d.bl.getIssues(n,s.id).then((function(e){return m(e.data)}))}),I);return function(){return clearInterval(e)}}),[]),(0,t.useEffect)((function(){k(!0),d.bl.getIssues(n,s.id).then((function(e){return m(e.data)})).finally((function(){return k(!1)}))}),[n]);var E=(0,t.useMemo)((function(){return{openIssues:v.filter((function(e){return e.state===h.OPENED})),testsIssues:v.filter((function(e){return e.labels.includes("Testing")&&e.state!==h.CLOSED})),closedIssues:v.filter((function(e){return e.state===h.CLOSED}))}}),[v]);function S(){return(S=(0,r.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.bl.createIssue(n,s.id,t);case 2:r=e.sent,m([r.data].concat((0,a.Z)(v))),L({isVisible:!1});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){L({isVisible:!1})}return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(u.UO,{children:[(0,p.jsx)(C,{issues:E,milestone:s,editHandler:c,isLoading:y}),(0,p.jsx)(Z,{issues:E,onCreateIssue:function(){L({isVisible:!0})}})]}),N.isVisible&&(0,o.createPortal)((0,p.jsx)(u.u_,{title:d.eI.create,onClose:O,footer:!1,children:(0,p.jsx)(j,{issue:null,onOk:function(e){return S.apply(this,arguments)},onCancel:O})}),document.body)]})}function Z(e){var s=e.issues,n=s.closedIssues,i=s.openIssues,r=s.testsIssues,a=e.onCreateIssue,c=(0,t.useState)({closedIssues:n,openIssues:i,testsIssues:r}),o=(0,l.Z)(c,2),f=o[0],x=o[1];return(0,t.useEffect)((function(){return x({closedIssues:n,openIssues:i,testsIssues:r})}),[n,i,r]),(0,p.jsxs)("div",{className:"milestone-body",children:[(0,p.jsxs)("div",{className:"controls",children:[(0,p.jsx)(u.zx,{type:"primary",onClick:a,children:d.eI.create}),(0,p.jsx)(u.II,{onChange:function(e){return function(e){function s(s){return String(s.iid).includes(e)||s.title.toLocaleLowerCase().includes(e.toLocaleLowerCase())}return e.length?x({closedIssues:n.filter(s),openIssues:i.filter(s),testsIssues:r.filter(s)}):x({closedIssues:n,openIssues:i,testsIssues:r})}(e.currentTarget.value)},placeholder:d.eI.search})]}),(0,p.jsxs)(u.iV,{children:[(0,p.jsx)(u.$l,{title:d.eI.open,issues:f.openIssues}),(0,p.jsx)(u.$l,{title:d.eI.test,type:"debug",issues:f.testsIssues}),(0,p.jsx)(u.$l,{title:d.eI.complite,type:"success",issues:f.closedIssues})]})]})}var b=n.p+"static/media/success.a0713b8f4e0a697f0f59c44a70d2e5fd.svg";function C(e){var s=e.issues,n=s.closedIssues,i=void 0===n?[]:n,r=s.openIssues,c=void 0===r?[]:r,o=s.testsIssues,f=void 0===o?[]:o,x=e.milestone,h=e.isLoading,m=e.editHandler,j=[].concat((0,a.Z)(i),(0,a.Z)(c),(0,a.Z)(f)),I=(0,d.OY)(i.length,j.length),g=(0,d.OY)(f.length+i.length,j.length),Z=(0,t.useMemo)((function(){return function(e){var s=new Map;return e.forEach((function(e){var n;return(null===(n=e.assignee)||void 0===n?void 0:n.id)&&s.set(e.assignee.id,e.assignee)})),(0,a.Z)(s).map((function(e){return(0,l.Z)(e,2)[1]}))}(j)}),[j]).map((function(e){return(0,p.jsx)(u.qE,{src:e.avatar_url},e.id)}));function C(){return x.state===v.CLOSED&&!h}var w=(0,d.Fd)(null===x||void 0===x?void 0:x.start_date,null===x||void 0===x?void 0:x.due_date);return(0,p.jsxs)("div",{className:"milestone-header ".concat(C()&&"closed"),children:[(0,p.jsxs)("div",{className:"milestone-header-first",children:[C()&&(0,p.jsx)("img",{src:b,alt:"success"}),(0,p.jsx)("span",{className:"title",children:h?(0,p.jsx)(u.Ho,{}):null===x||void 0===x?void 0:x.title}),(0,p.jsxs)("span",{className:"date",children:[(0,p.jsx)(k,{date:null===x||void 0===x?void 0:x.start_date,tooltip:d.eI.startLabel}),(0,p.jsx)(k,{date:null===x||void 0===x?void 0:x.due_date,tooltip:d.eI.endLabel,type:"end"}),w&&(0,p.jsxs)("span",{children:["(",d.eI.days,": ",w," )"]})]})]}),(0,p.jsx)("div",{className:"milestone-header-last",children:(0,p.jsxs)("div",{className:"slider",children:[(0,p.jsx)("div",{className:"slider-slide",children:(0,p.jsx)(u.zx,{type:"primary",onClick:function(e){return function(e,s){e.stopPropagation(),m(s)}(e,x)},children:d.eI.edit})}),(0,p.jsxs)("div",{className:"slider-slide",children:[(0,p.jsx)(u.HE,{max:3,children:Z}),(0,p.jsx)(u.Ex,{percent:I,extraPercent:g,children:(0,p.jsx)(y,{milestone:x,close:i.length,all:j.length})})]})]})})]})}function y(e){var s=e.close,n=e.all;return(0,p.jsx)("div",{className:"tasks-label",children:(0,p.jsxs)("span",{children:[d.eI.issues,":\xa0",(0,p.jsxs)("span",{className:"bold",children:[s,"/",n]})]})})}function k(e){var s=e.date,n=e.type;return s?(0,p.jsx)(u.IH,{text:(0,d.LJ)(s),type:n}):(0,p.jsx)(p.Fragment,{})}function w(e){var s=e.milestone,n=e.onOk,a=e.onCancel,o=(0,t.useState)(s||{}),f=(0,l.Z)(o,2),x=f[0],h=f[1],v=(0,t.useState)(!1),j=(0,l.Z)(v,2),I=j[0],g=j[1];function Z(e){var s=e.name,n=e.value;s&&h((0,c.Z)((0,c.Z)({},x),{},(0,m.Z)({},s,n)))}function b(){return(b=(0,r.Z)((0,i.Z)().mark((function e(s){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s.preventDefault(),g(!0),e.next=5,n(x);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:return e.prev=10,g(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])})))).apply(this,arguments)}return(0,p.jsxs)("form",{children:[(0,p.jsxs)(u.cw,{children:[(0,p.jsx)(u.__,{required:!0,children:d.eI.titleLable}),(0,p.jsx)(u.II,{required:!0,name:"title",value:null===x||void 0===x?void 0:x.title,onChange:function(e){return Z(e.target)},autofocus:!0})]}),(0,p.jsxs)(u.cw,{children:[(0,p.jsx)(u.__,{children:d.eI.descriptionLabel}),(0,p.jsx)(u.Kx,{name:"description",value:null===x||void 0===x?void 0:x.description,rows:5,onChange:function(e){return Z(e.target)}})]}),(0,p.jsxs)(u.X2,{children:[(0,p.jsxs)(u.cw,{children:[(0,p.jsx)(u.__,{children:d.eI.startLabel}),(0,p.jsx)(u.Mt,{name:"start_date",onChange:function(e){return Z(e.target)},value:null===x||void 0===x?void 0:x.start_date})]}),(0,p.jsxs)(u.cw,{children:[(0,p.jsx)(u.__,{children:d.eI.endLabel}),(0,p.jsx)(u.Mt,{name:"due_date",onChange:function(e){return Z(e.target)},value:null===x||void 0===x?void 0:x.due_date})]})]}),(0,p.jsx)(u.cw,{children:(0,p.jsxs)("div",{className:"actions",children:[(0,p.jsx)(u.zx,{onClick:a,children:d.eI.cancel}),(0,p.jsx)(u.zx,{type:"primary",onClick:function(e){return function(e){return b.apply(this,arguments)}(e)},loading:I,disabled:function(){var e;return!(null!==(e=x.title)&&void 0!==e&&e.length)}(),children:d.eI.save})]})})]})}function _(e){var s=e.projectId,n=(0,t.useState)({perPage:5,page:1}),f=(0,l.Z)(n,2),h=f[0],v=f[1],m=(0,t.useState)({loading:!1,milestones:[]}),j=(0,l.Z)(m,2),I=j[0],Z=j[1],b=(0,t.useState)({milestone:null,isVisible:!1}),C=(0,l.Z)(b,2),y=C[0],k=C[1];function _(e){k({isVisible:!0,milestone:e})}function N(e,s){return L.apply(this,arguments)}function L(){return L=(0,r.Z)((0,i.Z)().mark((function e(s,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(s,n);case 2:Z({milestones:I.milestones.map((function(e){return e.id===n.id?n:e}))}),k({isVisible:!1});case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function E(e,s){return S.apply(this,arguments)}function S(){return S=(0,r.Z)((0,i.Z)().mark((function e(s,n){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.bl.createMilestone(s,n);case 2:t=e.sent,Z({milestones:[t.data].concat((0,a.Z)(I.milestones))}),k({isVisible:!1});case 5:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function O(){return(O=(0,r.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.id){e.next=5;break}return e.next=3,N(s,n);case 3:e.next=7;break;case 5:return e.next=7,E(s,n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){k({isVisible:!1})}return(0,t.useEffect)((function(){Z((0,c.Z)((0,c.Z)({},I),{},{loading:!0})),d.bl.getMilestones(s,h).then((function(e){var s=e.data;Z({loading:!1,milestones:[].concat((0,a.Z)(I.milestones),(0,a.Z)(s))})}))}),[h]),(0,p.jsxs)("div",{className:"milestones",children:[(0,p.jsx)(x,{onClick:function(){k({isVisible:!0})}}),I.milestones.map((function(e){return(0,p.jsx)(g,{milestone:e,projectId:s,editHandler:_},e.id)})),(0,p.jsx)("div",{className:"milestones-next-button",children:(0,p.jsx)(u.zx,{onClick:function(){var e=h.page,s=h.perPage;v({page:e+1,perPage:s})},children:d.eI.showMore})}),y.isVisible&&(0,o.createPortal)((0,p.jsx)(u.u_,{title:y.milestone?d.eI.editMilestone:d.eI.createMilestone,onClose:V,footer:!1,children:(0,p.jsx)(w,{milestone:null===y||void 0===y?void 0:y.milestone,onCancel:V,onOk:function(e){return O.apply(this,arguments)}})}),document.body)]})}function N(){var e=(0,d.aM)(),s=Number(e.get("projectId"));return s?(0,p.jsx)(_,{projectId:s}):(0,p.jsx)("h3",{children:"\u041f\u0440\u043e\u0435\u043a\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"})}}}]);
//# sourceMappingURL=19.e86f24bc.chunk.js.map